import{j as s,r as u,d as C,g as N,h as T,i as S,u as I,B as h,k as B,L as P,l as z,m as O,n as A}from"./index-DQfEhixC.js";import{c as D,a as w,o as F}from"./index.esm-DZv9SKCn.js";import{a as H,u as U}from"./index.esm-DXmTgKDY.js";import{u as V}from"./user.api-CegBR8y8.js";class g extends Error{}g.prototype.name="InvalidTokenError";function L(a){return decodeURIComponent(atob(a).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function $(a){let e=a.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return L(e)}catch{return atob(e)}}function q(a,e){if(typeof a!="string")throw new g("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,r=a.split(".")[t];if(typeof r!="string")throw new g(`Invalid token specified: missing part #${t+1}`);let o;try{o=$(r)}catch(n){throw new g(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(o)}catch(n){throw new g(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}const k=({children:a})=>s.jsx("div",{className:"my-4 flex flex-col gap-y-2 ",children:a}),K=u.createContext(null),y={didCatch:!1,error:null};let R=class extends u.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=y}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(e!==null){for(var t,r,o=arguments.length,n=new Array(o),l=0;l<o;l++)n[l]=arguments[l];(t=(r=this.props).onReset)===null||t===void 0||t.call(r,{args:n,reason:"imperative-api"}),this.setState(y)}}componentDidCatch(e,t){var r,o;(r=(o=this.props).onError)===null||r===void 0||r.call(o,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:o}=this.props;if(r&&t.error!==null&&Y(e.resetKeys,o)){var n,l;(n=(l=this.props).onReset)===null||n===void 0||n.call(l,{next:o,prev:e.resetKeys,reason:"keys"}),this.setState(y)}}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:o}=this.props,{didCatch:n,error:l}=this.state;let i=e;if(n){const m={error:l,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")i=t(m);else if(r)i=u.createElement(r,m);else if(o!==void 0)i=o;else throw l}return u.createElement(K.Provider,{value:{didCatch:n,error:l,resetErrorBoundary:this.resetErrorBoundary}},i)}};function Y(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return a.length!==e.length||a.some((t,r)=>!Object.is(t,e[r]))}function G(a,e){const t=u.forwardRef((o,n)=>u.createElement(R,e,u.createElement(a,{...o,ref:n}))),r=a.displayName||a.name||"Unknown";return t.displayName="withErrorBoundary(".concat(r,")"),t}const J=()=>s.jsx("div",{className:"rounded-lg bg-red-100 p-5 text-red-500",children:"Look like component is error"}),M=({pointer:a,variant:e,children:t,control:r,name:o,type:n,error:l="",placeholder:i="",...m})=>{const{field:x}=H({control:r,name:o,defaultValue:""});let c="text-sm font-medium font-Poppins transition-all w-full dark:border-dark-stroke dark:text-black ";switch(e){case"outlined":c+="rounded-xl border bg-transparent px-6 py-4 text-c3";break;case"text":c=c;break}return s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:n,className:C(c,l.length>0?"border-red-700 text-red-700":"border-gray-c3 text-black",t?"pr-16":"",a&&"cursor-pointer"),placeholder:l.length>0?"":i,...x,...m}),t&&s.jsx("span",{className:"absolute right-6 top-2/4 -translate-y-2/4 cursor-pointer select-none",children:t})]})},E=G(M,{FallbackComponent:J}),W=({open:a=!1,...e})=>a?s.jsx(N,{...e,onClick:e.onClick}):s.jsx(T,{...e,onClick:e.onClick});function Q(a=!1){const[e,t]=u.useState(a);return{value:e,handleToggleValue:()=>{t(!e)}}}const X=D({email:w().required("Please enter your email address!").matches(/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,{message:"Please enter valid email address"}),password:w().required("Please enter your password").min(8,"Password must be 8 characters")});function ae(){var m,x;const a=S(),e=I(),t=async c=>{const{email:f,password:p}=c;e("/admin"),await z.login(f,p).then(async d=>{const v=q(d.data.accessToken);v.admin?(sessionStorage.setItem("accessToken",d.data.accessToken),sessionStorage.setItem("refreshToken",d.data.refreshToken),a(O({accessToken:d.data.accessToken,refreshToken:d.data.refreshToken})),sessionStorage.setItem("admin","true"),await V.getMe(v.sub).then(b=>{const j=b.data;a(A(j)),e("/admin"),h.success("Đăng nhập thành công!",{autoClose:500,delay:10,draggable:!0,pauseOnHover:!1,position:"bottom-right"})}).catch(b=>{h.error(b.message,{autoClose:500,delay:10,draggable:!0,pauseOnHover:!1,position:"bottom-right"})})):h.warning("Bạn không có quyền truy cập trang này!",{autoClose:500,delay:10,draggable:!0,pauseOnHover:!1,position:"bottom-right"})}).catch(d=>{d.status===404&&h.error("Người dùng không có xuất hiện trong hệ thống!",{autoClose:500,delay:10,draggable:!0,pauseOnHover:!1,position:"bottom-right"})})},{value:r,handleToggleValue:o}=Q(),{handleSubmit:n,control:l,formState:{errors:i}}=U({resolver:F(X),mode:"onSubmit"});return u.useEffect(()=>{var f,p;const c=Object.values(i);if(c.length>0&&(f=c[0])!=null&&f.message){const d=(p=c[0])==null?void 0:p.message;h.error(d.toString(),{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50})}},[i]),s.jsx("div",{className:"flex bg-transparent w-full h-screen",children:s.jsxs("div",{className:"flex flex-col items-center m-auto p-5 bg-white rounded-2xl shadow-lg w-[40%]",children:[s.jsx(B,{}),s.jsx(P,{to:"/admin",children:s.jsx("h1",{className:"text-black text-3xl font-bold",children:"Sport Store"})}),s.jsxs("form",{className:"text-center w-[70%] mx-auto",onSubmit:n(t),children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsxs(k,{children:[s.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Email"}),s.jsx(E,{variant:"outlined",control:l,name:"email",type:"email",placeholder:"Your email address",error:((m=i.email)==null?void 0:m.message)??""})]}),s.jsxs(k,{children:[s.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Password"}),s.jsx(E,{variant:"outlined",control:l,name:"password",type:r?"text":"password",placeholder:"Your password",error:((x=i.email)==null?void 0:x.message)??"",children:s.jsx(W,{open:r,onClick:o})})]})]}),s.jsx("button",{className:"mb-4 transition ease-in-out delay-250 hover:-translate-y-1 hover:scale-110 border border-gray-c3 p-2 rounded-xl bg-warning text-white text-lg font-semibold",type:"submit",children:"Đăng nhập"})]})]})})}export{ae as default};
