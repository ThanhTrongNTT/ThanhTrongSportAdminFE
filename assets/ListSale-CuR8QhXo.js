import{r,B as C,j as e,d as J,e as K}from"./index-C1Wk_G0d.js";import{D as E,P as Q}from"./ToggleSwitch-BfsT0YiX.js";import{F as p,s as G}from"./schema.resolver--PtLukJb.js";import{p as F,f as S,i as H}from"./parse-Bk9b6LgS.js";import{o as B}from"./index.esm-_rkH4Ol4.js";import{u as L,C as V}from"./index.esm-C464XQNg.js";import{M as I,a as W}from"./ModalDelete-od32og9x.js";import{s as M}from"./sales.api-BE_qZA-7.js";const X=({handleCreateNew:a,sale:l,setSale:m})=>{var f,j,b,u;const{handleSubmit:d,control:c,reset:h,getValues:x,setValue:D,formState:{errors:o}}=L({resolver:B(G),mode:"onSubmit",defaultValues:{name:l.name,description:l.description,code:l.code,discount:l.discount,startDate:l.startDate,endDate:l.endDate}}),v=()=>{h(H),m(H)};r.useEffect(()=>{h({name:l.name,description:l.description,code:l.code,discount:l.discount,startDate:l.startDate,endDate:l.endDate})},[l,h]);const g=async t=>{if(console.log(t),t.startDate&&t.endDate&&t.startDate>=t.endDate){C.error("End date must be greater than start date",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50});return}await a(t),v()},i=t=>{t&&(console.log(S.format(t).replace(",","")),D("startDate",S.format(t).replace(",","")))},y=t=>{t&&(console.log(S.format(t).replace(",","")),D("endDate",S.format(t).replace(",","")),console.log("get Value",x("endDate")))};return r.useEffect(()=>{var k,N;const t=Object.values(o);if(t.length>0&&(k=t[0])!=null&&k.message){const P=(N=t[0])==null?void 0:N.message;C.error(P.toString(),{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50})}},[o]),e.jsx("div",{className:"w-[800px]",children:e.jsx("div",{className:"bg-white mt-10 rounded-md px-10 pt-10 pb-5",children:e.jsxs("form",{onSubmit:d(g),children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Thêm mới khuyến mãi"}),e.jsxs("div",{className:"text-right mt-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Tên"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(p,{control:c,name:"name",id:"sale-name",placeholder:"Nhập tên...",error:((f=o.name)==null?void 0:f.message)??"",onChange:t=>m({...l,name:t.target.value})})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mô tả"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(p,{control:c,name:"description",id:"sale-description",placeholder:"Nhập mô tả...",error:((j=o.description)==null?void 0:j.message)??"",onChange:t=>{m({...l,description:t.target.value})}})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mã khuyến mãi"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(p,{control:c,name:"code",id:"sale-code",placeholder:"Nhập mã...",error:((b=o.code)==null?void 0:b.message)??"",onChange:t=>m({...l,code:t.target.value})})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Giảm"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(p,{control:c,name:"discount",id:"sale-discount",type:"number",placeholder:"Nhập giảm...",error:((u=o.discount)==null?void 0:u.message)??"",onChange:t=>{m({...l,discount:parseInt(t.target.value)})}})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày bắt đầu"}),e.jsx(V,{name:"startDate",control:c,render:({field:t})=>e.jsx(E,{language:"vi",value:t.value?F(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:i})})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày kết thúc"}),e.jsx(V,{name:"endDate",control:c,render:({field:t})=>e.jsx(E,{language:"vi",value:t.value?F(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:y})})]})]}),e.jsx("button",{type:"submit",className:"mt-10 font-semibold text-white bg-gradient-to-br from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 px-4 py-2 rounded-md inline-block transition-all",children:"Thêm mới"})]})]})})})},Y=({sale:a,handleUpdate:l})=>{var f,j,b,u;const{handleSubmit:m,control:d,getValues:c,setValue:h,formState:{errors:x},watch:D}=L({resolver:B(G),mode:"onSubmit",defaultValues:{name:a.name,description:a.description,code:a.code,discount:a.discount,startDate:a.startDate,endDate:a.endDate}}),o=t=>{t&&h("startDate",S.format(t).replace(",",""))},v=t=>{t&&h("endDate",S.format(t).replace(",",""))},g=async t=>{if(t.startDate&&t.endDate&&t.startDate>=t.endDate){C.error("End date must be greater than start date",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50});return}l(t)},i=D(),y=()=>i.name===a.name&&i.code===a.code&&i.description===a.description&&i.discount===a.discount&&i.startDate===a.startDate&&i.endDate===a.endDate;return r.useEffect(()=>{console.log("Start Date",c("startDate")),console.log("End Date",c("endDate"))},[]),e.jsx("div",{className:"w-[800px]",children:e.jsx("div",{className:"bg-white mt-10 rounded-md px-10 pt-10 pb-5",children:e.jsxs("form",{onSubmit:m(g),children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Update Sale"}),e.jsxs("div",{className:"text-right mt-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Sale Name"}),e.jsx(p,{control:d,name:"name",id:"sale-name",placeholder:"Enter Sale name...",error:((f=x.name)==null?void 0:f.message)??""})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Description"}),e.jsx(p,{control:d,name:"description",id:"sale-description",placeholder:"Enter Description...",error:((j=x.description)==null?void 0:j.message)??""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Sale Code"}),e.jsx(p,{control:d,name:"code",id:"sale-code",placeholder:"Enter Sale code...",error:((b=x.code)==null?void 0:b.message)??""})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Discount"}),e.jsx(p,{control:d,name:"discount",id:"sale-discount",type:"number",placeholder:"Enter Discount...",error:((u=x.discount)==null?void 0:u.message)??""})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Start Date"}),e.jsx(V,{name:"startDate",control:d,render:({field:t})=>e.jsx(E,{language:"vi",value:t.value?F(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:o})})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"End Date"}),e.jsx(V,{name:"endDate",control:d,render:({field:t})=>e.jsx(E,{language:"vi",value:t.value?F(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:v})})]})]}),e.jsx("button",{type:"submit",className:J("mt-10 font-semibold px-4 py-2 rounded-md inline-block transition-all",y()?"bg-gray-300 text-gray-500 cursor-not-allowed":"text-white bg-gradient-to-br from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 cursor-pointer"),disabled:y(),children:"Update Category"})]})]})})})},ne=()=>{const[a,l]=r.useState(1),[m,d]=r.useState(1),[c,h]=r.useState([]),[x,D]=r.useState(!1),[o,v]=r.useState(!1),[g,i]=r.useState(!1),[y,f]=r.useState(""),[j,b]=r.useState(H),[u,t]=r.useState(H),k=s=>{l(s)},N=s=>{M.getAllSales(s-1,5,"modifiedDate","").then(n=>{n.result&&(d(n.data.totalPages),h(n.data.items))})},P=s=>{const n={id:"",name:s.name,description:s.description,code:s.code,discount:s.discount,startDate:s.startDate,endDate:s.endDate};console.log(n),M.createSale(n).then(w=>{w.result&&(U(),C.success("Create Sale success!",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50}),N(a))})},U=()=>{D(!x)},R=s=>{const n={id:u.id,name:s.name,description:s.description,code:s.code,discount:s.discount,startDate:s.startDate,endDate:s.endDate};M.updateSale(n).then(w=>{w.result&&(T(),C.success("Update Success!",{autoClose:5e3,delay:50,draggable:!0,pauseOnHover:!1}),N(a))})},q=s=>{t(s),v(!o)},T=()=>{v(!o)},z=async s=>{i(!g),await M.deleteSale(s).then(n=>{n&&n.result&&(C.success("Delete Success!",{autoClose:5e3,delay:50,draggable:!0,pauseOnHover:!1}),N(a))})},O=()=>{i(!g)};return r.useEffect(()=>{N(a)},[a]),e.jsxs(e.Fragment,{children:[e.jsx(I,{isVisible:x,onClose:U,children:e.jsx("div",{children:e.jsx(X,{handleCreateNew:P,sale:j,setSale:b})})}),e.jsx(I,{isVisible:o,onClose:T,children:e.jsx("div",{children:e.jsx(Y,{handleUpdate:R,sale:u})})}),e.jsx(I,{isVisible:g,onClose:O,children:e.jsx(W,{id:y,handleDelete:z,title:"Are you sure to delete this sale?",onCloseDelModal:O})}),e.jsx("div",{className:"",children:e.jsxs("button",{className:"flex items-center text-black bg-white p-1 mx-8 my-2 rounded-2xl border border-gray-c4",onClick:U,children:[e.jsx(K,{}),e.jsx("span",{className:"flex items-center mr-2",children:"Thêm mới"})]})}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"p-5",children:e.jsx("div",{className:"overflow-x-auto rounded-2xl border mx-4 border-gray-c4 ",children:e.jsxs("table",{className:"bg-white w-full text-sm text-left text-gray-400",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3 px-6",children:"Tên"}),e.jsx("th",{scope:"col",className:"px-6",children:"Mã khuyến mãi"}),e.jsx("th",{scope:"col",className:"px-6",children:"Mô tả"}),e.jsx("th",{scope:"col",className:"px-6",children:"Giảm"}),e.jsx("th",{scope:"col",className:"px-6",children:"Ngày bắt đầu"}),e.jsx("th",{scope:"col",className:"px-6",children:"Ngày kết thúc"}),e.jsx("th",{scope:"col",className:"px-6 text-center",children:"Action"})]})}),e.jsx("tbody",{children:c.map((s,n)=>{var w,A;return e.jsxs("tr",{className:"bg-white border border-gray-c2 hover:bg-gray-c2 cursor-pointer",children:[e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:s.name}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:s.code}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black ",children:s.description}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium whitespace-nowrap",children:s.discount+" %"}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:(w=s.startDate)==null?void 0:w.toString()}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:(A=s.endDate)==null?void 0:A.toString()}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-white hover:bg-white hover:text-black bg-success  rounded-lg px-2 mx-2",onClick:()=>q(s),children:"Edit"}),e.jsx("span",{className:"text-white bg-warning rounded-lg px-2 hover:bg-white hover:text-black mx-2",onClick:()=>{f(s.id??""),O()},children:"Delete"})]})})]},n)})})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Q,{showIcons:!0,currentPage:a,totalPages:m,onPageChange:k,layout:"pagination"})})]})]})};export{ne as default};
