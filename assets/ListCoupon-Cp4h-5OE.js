import{A as M,r as o,B as C,j as e,d as K,e as Q}from"./index-D2n9cPuO.js";import{M as I,a as W}from"./ModalDelete-D0qBAmpD.js";import{f as h,p as H}from"./parse-Bk9b6LgS.js";import{D as V,P as X}from"./ToggleSwitch-B1KMvkgZ.js";import{F as w,a as G}from"./schema.resolver-BxNfw8r1.js";import{o as B}from"./index.esm-Dzjb_IoB.js";import{u as z,C as E}from"./index.esm-BFtL9RYl.js";const F={getAllCoupon:async(s,l,u,n)=>{const i=`/coupons?pageNo=${s}&pageSize=${l}&sortBy=${u}&sortDir=${n}`;return M.get(i)},createCoupon:async s=>M.post("/coupon",s),updateCoupon:async s=>{const l=`/coupon/${s.id}`;return M.put(l,s)},deleteCoupon:async s=>{const l=`/coupon/${s}`;return M.delete(l)}},T=new Date,P={id:"",description:"",code:"",discount:0,startDate:h.format(T).replace(",",""),endDate:h.format(T).replace(",","")},Y=({coupon:s,setCoupon:l,handleCreateNew:u})=>{var g,f,j;const{handleSubmit:n,control:i,reset:m,getValues:x,setValue:b,formState:{errors:c}}=z({resolver:B(G),mode:"onSubmit",defaultValues:{description:s.description,code:s.code,discount:s.discount,startDate:s.startDate,endDate:s.endDate}}),N=()=>{m(P),l(P)};o.useEffect(()=>{m({description:s.description,code:s.code,discount:s.discount,startDate:s.startDate,endDate:s.endDate})},[s,m]);const p=async t=>{if(t.startDate&&t.endDate&&t.startDate>=t.endDate){C.error("End date must be greater than start date",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50});return}console.log(t),await u(t),N()},d=t=>{t&&(console.log(h.format(t).replace(",","")),b("startDate",h.format(t).replace(",","")))},D=t=>{t&&(console.log(h.format(t).replace(",","")),b("endDate",h.format(t).replace(",","")),console.log("get Value",x("endDate")))};return o.useEffect(()=>{var S,k;const t=Object.values(c);if(t.length>0&&(S=t[0])!=null&&S.message){const v=(k=t[0])==null?void 0:k.message;C.error(v.toString(),{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50})}},[c]),e.jsx("div",{className:"w-[800px]",children:e.jsx("div",{className:"bg-white mt-10 rounded-md px-10 pt-10 pb-5",children:e.jsxs("form",{onSubmit:n(p),children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Thêm mới mã giảm giá"}),e.jsxs("div",{className:"text-right mt-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mã giảm giá"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:i,name:"code",id:"coupon-code",placeholder:"Nhập mã giảm giá...",error:((g=c.code)==null?void 0:g.message)??"",onChange:t=>l({...s,code:t.target.value})})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Giảm giá"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:i,name:"discount",id:"coupon-discount",type:"number",placeholder:"Nhập giảm giá...",error:((f=c.discount)==null?void 0:f.message)??"",onChange:t=>{l({...s,discount:parseInt(t.target.value)})}})]})]}),e.jsx("div",{className:"",children:e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mô tả"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:i,name:"description",id:"coupon-description",placeholder:"Nhập mô tả...",error:((j=c.description)==null?void 0:j.message)??"",onChange:t=>l({...s,description:t.target.value})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày bắt đầu"}),e.jsx(E,{name:"startDate",control:i,render:({field:t})=>e.jsx(V,{language:"vi",value:t.value?H(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:d})})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày kết thúc"}),e.jsx(E,{name:"endDate",control:i,render:({field:t})=>e.jsx(V,{language:"vi",value:t.value?H(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:D})})]})]}),e.jsx("button",{type:"submit",className:"mt-10 font-semibold text-white bg-gradient-to-br from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 px-4 py-2 rounded-md inline-block transition-all",children:"Thêm mới"})]})]})})})},Z=({coupon:s,handleUpdate:l})=>{var g,f,j;const{handleSubmit:u,control:n,getValues:i,setValue:m,formState:{errors:x},watch:b}=z({resolver:B(G),mode:"onSubmit",defaultValues:{description:s.description,code:s.code,discount:s.discount,startDate:s.startDate,endDate:s.endDate}}),c=async t=>{if(t.startDate&&t.endDate&&t.startDate>=t.endDate){C.error("End date must be greater than start date",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50});return}l(t)},N=t=>{t&&m("startDate",h.format(t).replace(",",""))},p=t=>{t&&m("endDate",h.format(t).replace(",",""))},d=b(),D=()=>d.code===s.code&&d.description===s.description&&d.discount===s.discount&&d.startDate===s.startDate&&d.endDate===s.endDate;return e.jsx("div",{className:"w-[800px]",children:e.jsx("div",{className:"bg-white mt-10 rounded-md px-10 pt-10 pb-5",children:e.jsxs("form",{onSubmit:u(c),children:[e.jsx("h1",{className:"font-bold text-2xl text-center",children:"Thông tin mã giảm giá"}),e.jsxs("div",{className:"text-right mt-10",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mã giảm giá"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:n,name:"code",id:"coupon-code",placeholder:"Nhập mã giảm giá...",error:((g=x.code)==null?void 0:g.message)??""})]}),e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Giảm giá"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:n,name:"discount",id:"coupon-discount",type:"number",placeholder:"Nhập giảm giá...",error:((f=x.discount)==null?void 0:f.message)??""})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-10",children:e.jsxs("div",{className:"text-left",children:[e.jsxs("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:["Mô tả"," ",e.jsx("span",{className:"text-red-500",children:"(*)"})]}),e.jsx(w,{control:n,name:"description",id:"coupon-description",placeholder:"Nhập mô tả...",error:((j=x.description)==null?void 0:j.message)??""})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-10",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày bắt đầu"}),e.jsx(E,{name:"startDate",control:n,render:({field:t})=>e.jsx(V,{language:"vi",value:t.value?H(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:N})})]}),e.jsxs("div",{className:"text-left",children:[e.jsx("label",{htmlFor:"",className:"text-lg font-semibold text-left",children:"Ngày kết thúc"}),e.jsx(E,{name:"endDate",control:n,render:({field:t})=>e.jsx(V,{language:"vi",value:t.value?H(t.value,"dd/MM/yyyy HH:mm:ss",new Date):null,onChange:p})})]})]}),e.jsx("button",{type:"submit",className:K("mt-10 font-semibold px-4 py-2 rounded-md inline-block transition-all",D()?"bg-gray-300 text-gray-500 cursor-not-allowed":"text-white bg-gradient-to-br from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 cursor-pointer"),disabled:D(),children:"Cập nhật"})]})]})})})},oe=()=>{const[s,l]=o.useState(1),[u,n]=o.useState(1),[i,m]=o.useState([]),[x,b]=o.useState(!1),[c,N]=o.useState(!1),[p,d]=o.useState(!1),[D,g]=o.useState(""),[f,j]=o.useState(P),[t,S]=o.useState(P),k=a=>{l(a)},v=a=>{F.getAllCoupon(a-1,5,"modifiedDate","").then(r=>{r&&(n(r.data.totalPages),m(r.data.items))})},L=a=>{const r={code:a.code,description:a.description,discount:a.discount,startDate:a.startDate,endDate:a.endDate};F.createCoupon(r).then(y=>{y.result&&(A(),C.success("Create Sale success!",{autoClose:1e3,pauseOnHover:!1,draggable:!0,delay:50}),v(s))})},A=()=>{b(!x)},R=a=>{const r={id:t.id,description:a.description,code:a.code,discount:a.discount,startDate:a.startDate,endDate:a.endDate};F.updateCoupon(r).then(y=>{y.result&&(U(),C.success("Update Success!",{autoClose:5e3,delay:50,draggable:!0,pauseOnHover:!1}),v(s))})},q=a=>{S(a),N(!c)},U=()=>{N(!c)},J=async a=>{d(!p),await F.deleteCoupon(a).then(r=>{r&&r.result&&(C.success("Delete Success!",{autoClose:5e3,delay:50,draggable:!0,pauseOnHover:!1}),v(s))})},O=()=>{d(!p)};return o.useEffect(()=>{v(s)},[s]),e.jsxs(e.Fragment,{children:[e.jsx(I,{isVisible:x,onClose:A,children:e.jsx("div",{children:e.jsx(Y,{handleCreateNew:L,coupon:f,setCoupon:j})})}),e.jsx(I,{isVisible:c,onClose:U,children:e.jsx("div",{children:e.jsx(Z,{handleUpdate:R,coupon:t})})}),e.jsx(I,{isVisible:p,onClose:O,children:e.jsx(W,{id:D,handleDelete:J,title:"Are you sure to delete this coupon?",onCloseDelModal:O})}),e.jsx("div",{className:"",children:e.jsxs("button",{className:"flex items-center text-black bg-white p-1 mx-8 my-2 rounded-2xl border border-gray-c4",onClick:A,children:[e.jsx(Q,{}),e.jsx("span",{className:"flex items-center mr-2",children:"Thêm mới"})]})}),e.jsxs("div",{className:"",children:[e.jsx("div",{className:"p-5",children:e.jsx("div",{className:"overflow-x-auto rounded-2xl border mx-4 border-gray-c4 ",children:e.jsxs("table",{className:"bg-white w-full text-sm text-left text-gray-400",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"py-3 px-6",children:"Mã giảm giá"}),e.jsx("th",{scope:"col",className:"px-6",children:"Mô tả"}),e.jsx("th",{scope:"col",className:"px-6",children:"Giảm giá"}),e.jsx("th",{scope:"col",className:"px-6",children:"Ngày bắt đầu"}),e.jsx("th",{scope:"col",className:"px-6",children:"Ngày kết thúc"}),e.jsx("th",{scope:"col",className:"px-6 text-center",children:"Action"})]})}),e.jsx("tbody",{children:i.map((a,r)=>{var y,$;return e.jsxs("tr",{className:"bg-white border border-gray-c2 hover:bg-gray-c2 cursor-pointer",children:[e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:a.code}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black ",children:a.description}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium whitespace-nowrap",children:a.discount+" %"}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:(y=a.startDate)==null?void 0:y.toString()}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:($=a.endDate)==null?void 0:$.toString()}),e.jsx("th",{scope:"row",className:"py-4 px-6 font-medium text-black whitespace-nowrap",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-white hover:bg-white hover:text-black bg-success  rounded-lg px-2 mx-2",onClick:()=>q(a),children:"Edit"}),e.jsx("span",{className:"text-white bg-warning rounded-lg px-2 hover:bg-white hover:text-black mx-2",onClick:()=>{g(a.id??""),O()},children:"Delete"})]})})]},r)})})]})})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(X,{showIcons:!0,currentPage:s,totalPages:u,onPageChange:k,layout:"pagination"})})]})]})};export{oe as default};
